<UserControl x:Class="WMS.Client.Views.WholesaleDialog"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             Height="700" Width="1000">
    <Grid Background="White">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <TextBlock Text="{Binding DialogTitle}" FontSize="24" FontWeight="Bold" Margin="20" HorizontalAlignment="Center" Foreground="#673AB7"/>

        <materialDesign:Card Grid.Row="1" Margin="20,0,20,10" Padding="15">
            <StackPanel Orientation="Horizontal">
                <TextBox Text="{Binding CurrentOrder.OrderNo}" materialDesign:HintAssist.Hint="批发单号" Style="{StaticResource MaterialDesignFloatingHintTextBox}" IsReadOnly="True" Width="150" Margin="0,0,20,0"/>

                <ComboBox Width="150" Margin="0,0,20,0" 
                          materialDesign:HintAssist.Hint="选择客户" 
                          IsEditable="True" Style="{StaticResource MaterialDesignFloatingHintComboBox}" 
                          ItemsSource="{Binding CustomerList}" 
                          Text="{Binding CurrentOrder.Customer}" />

                <DatePicker SelectedDate="{Binding CurrentOrder.OrderDate}" materialDesign:HintAssist.Hint="销售日期" Style="{StaticResource MaterialDesignFloatingHintDatePicker}" Width="120" Margin="0,0,20,0"/>

                <TextBox Text="{Binding CurrentOrder.Remark}" materialDesign:HintAssist.Hint="备注信息" Style="{StaticResource MaterialDesignFloatingHintTextBox}" Width="200"/>
            </StackPanel>
        </materialDesign:Card>

        <DataGrid Grid.Row="2" Margin="20,0,20,10" 
                  ItemsSource="{Binding OrderItems}" 
                  AutoGenerateColumns="False" CanUserAddRows="False"
                  Style="{StaticResource MaterialDesignDataGrid}">
            <DataGrid.Columns>
                <DataGridTextColumn Header="产品名称" Binding="{Binding ProductName}" Width="*"/>
                <DataGridTextColumn Header="数量" Binding="{Binding Quantity}" Width="100"/>
                <DataGridTextColumn Header="单价" Binding="{Binding Price, StringFormat=C2}" Width="100"/>
                <DataGridTextColumn Header="小计" Binding="{Binding SubTotal, StringFormat=C2}" Width="100" FontWeight="Bold" Foreground="#673AB7"/>
                <DataGridTemplateColumn Header="操作" Width="80">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <Button Style="{StaticResource MaterialDesignIconButton}" Foreground="Red" 
                                    Command="{Binding DataContext.RemoveItemCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" 
                                    CommandParameter="{Binding}">
                                <materialDesign:PackIcon Kind="Delete" />
                            </Button>
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
            </DataGrid.Columns>
        </DataGrid>

        <materialDesign:Card Grid.Row="3" Margin="20,0,20,10" Padding="10" Background="#F5F5F5">
            <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                <materialDesign:PackIcon Kind="PlaylistPlus" VerticalAlignment="Center" Margin="0,0,10,0"/>
                <TextBlock Text="添加商品：" VerticalAlignment="Center" FontWeight="Bold" Margin="0,0,10,0"/>

                <ComboBox Width="150" Margin="0,0,10,0" materialDesign:HintAssist.Hint="选择产品" 
                          IsEditable="True" ItemsSource="{Binding ProductList}" 
                          Text="{Binding TempProductName}" />

                <TextBox Width="80" Margin="0,0,10,0" materialDesign:HintAssist.Hint="数量" Text="{Binding TempQuantity}"/>
                <TextBox Width="80" Margin="0,0,10,0" materialDesign:HintAssist.Hint="单价" Text="{Binding TempPrice}"/>

                <Button Content="添加" Command="{Binding AddItemCommand}" Style="{StaticResource MaterialDesignFlatButton}" Height="30"/>
            </StackPanel>
        </materialDesign:Card>

        <Grid Grid.Row="4" Margin="20">
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Left" VerticalAlignment="Center">
                <TextBlock Text="整单合计：" FontSize="20"/>
                <TextBlock Text="{Binding TotalOrderAmount, StringFormat=C2}" FontSize="24" FontWeight="Bold" Foreground="#673AB7" Margin="10,0,0,0"/>
            </StackPanel>

            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                <Button Command="{Binding PrintOrderCommand}" Content="打印预览" Style="{StaticResource MaterialDesignOutlinedButton}" Margin="0,0,10,0"/>

                <Button Command="{x:Static materialDesign:DialogHost.CloseDialogCommand}" CommandParameter="True" Content="保存单据" Style="{StaticResource MaterialDesignRaisedButton}"/>
                <Button Command="{x:Static materialDesign:DialogHost.CloseDialogCommand}" CommandParameter="False" Content="取消" Style="{StaticResource MaterialDesignFlatButton}" Margin="10,0,0,0"/>
            </StackPanel>
        </Grid>
    </Grid>
</UserControl>